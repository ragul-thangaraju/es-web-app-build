(this["webpackJsonpes-web-app"]=this["webpackJsonpes-web-app"]||[]).push([[0],{86:function(e,t,n){},90:function(e,t,n){"use strict";n.r(t);var r=n(0),o=n.n(r),a=n(23),s=n.n(a),c=n(16),i=n(15),u=n(28),l=n(18),d="SET_AUTH_TOKENS",p={currentUser:{}},h=Object(i.c)({currentUser:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:p,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case d:return Object(l.a)(Object(l.a)({},e),{},{currentUser:Object(l.a)({},t.payload)});default:return e}}}),f=n(10),b=n(11),j=n(14),m=n(13),w=n(45),v=n(3),O=n(44),g=n(4),x=n.n(g),k="",y="",E=!0;"localhost"===window.location.hostname?(k="https://devapi.embassysocial.io/v1",y="",E=!0):(window.location.hostname,k="",y="",E=!1);var _,T=E,L=k,P=y,S="/auth/authToken",C=0;function N(){var e;T&&(e=console).log.apply(e,arguments)}var A=function(){return"object"===typeof x.a.get("userSession")&&(_||U(),!0)},I=function(){x.a.clearAll(),clearInterval(_),window.location.href="/"},U=function(){C=0,_=setInterval((function(){++C>2400&&I()}),1e3)},D=function(){C=0};document.addEventListener("keypress",(function(){A()&&D()}),!1),document.addEventListener("keydown",(function(){A()&&D()}),!1),document.addEventListener("mousemove",(function(){A()&&D()}),!1),window.addEventListener("offline",(function(){N("App is offline")})),window.addEventListener("online",(function(){N("App is online")}));var F="/login",R="/redirect",W="/",H=n(21),z=function(e){return void 0===e||null===e||""===e.trim()},G=n(7),M=n.n(G),X=n(17),q=n(29),J=n.n(q),K=J.a.create({baseURL:L}),$=J.a.create({baseURL:L});$.interceptors.request.use((function(e){var t=e,n=x.a.get("userSession");return B.isTokenExpired()?(N("access token expires in 10 secs && refresh token called"),B.refresh_token(n.refresh_token).then((function(e){return x.a.set("userSession",e),e&&e.refresh_token&&e.expires_in&&x.a.set("expiryTime",B.tokenExpires(e.expires_in)),t.Authorization=e.token_type+" "+e.access_token,t})).catch((function(e){N("Refresh Token Error",e),I()}))):e}),(function(e){return Promise.reject(e)})),$.interceptors.response.use((function(e){return e}),function(){var e=Object(X.a)(M.a.mark((function e(t){var n;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(401!==t.response.status){e.next=4;break}return N("Access token expired && calling refresh token ..."),n=x.a.get("userSession"),e.abrupt("return",B.refresh_token(n.refresh_token).then((function(e){return x.a.set("userSession",e),e&&e.refresh_token&&e.expires_in&&x.a.set("expiryTime",B.tokenExpires(e.expires_in)),t.config.headers.Authorization=e.token_type+" "+e.access_token,Promise.resolve($(t.config))})).catch((function(e){N("Refresh Token Error",e),I()})));case 4:return e.abrupt("return",Promise.reject(t.response));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());var B=function(){function e(){Object(f.a)(this,e)}return Object(b.a)(e,null,[{key:"httpHeader",value:function(e){var t=new Date,n={};return n={"Content-Type":"application/json",offset:t.getTimezoneOffset()},e&&(n={"Content-Type":"application/json",offset:t.getTimezoneOffset(),Authorization:"object"===typeof x.a.get("userSession")?"".concat(x.a.get("userSession").token_type," ").concat(x.a.get("userSession").access_token):""}),n}},{key:"isTokenExpired",value:function(){var e=x.a.get("expiryTime");return Date.now()>e-12e4||Date.now()>e}},{key:"tokenExpires",value:function(e){return Date.now()+1e3*e}},{key:"OAUTH",value:function(t,n){return new Promise((function(r,o){var a={headers:{"Access-Control-Allow-Origin":"*","Content-Type":"application/x-www-form-urlencoded"},url:P,method:"POST",auth:{username:"web_app",password:"changeit"},data:"grant_type=password&scope=openid&username=".concat(t,"&password=").concat(n)};N("GET ::::::: INPUT",a),e.callAPI(a,r,o,!0)}))}},{key:"get",value:function(t,n,r){return new Promise((function(o,a){var s={method:"GET",url:t,params:n,headers:e.httpHeader(r)};N("GET ::::::: INPUT",s),e.callAPI(s,o,a,!1)}))}},{key:"post",value:function(t,n,r){return new Promise((function(o,a){var s={method:"POST",url:t,data:n,headers:e.httpHeader(r)};N("POST ::::: Input",s),e.callAPI(s,o,a,!1)}))}},{key:"put",value:function(t,n,r){return new Promise((function(o,a){var s={method:"PUT",url:t,data:n,headers:e.httpHeader(r)};N("PUT ::::::: INPUT",s),e.callAPI(s,o,a,!1)}))}},{key:"delete",value:function(t,n,r){return new Promise((function(o,a){var s={method:"DELETE",url:t,params:n,headers:e.httpHeader(r)};N("DELETE ::::::: INPUT",s),e.callAPI(s,o,a,!1)}))}},{key:"refresh_token",value:function(t){return new Promise((function(n,r){var o={headers:{"Access-Control-Allow-Origin":"*","Content-Type":"application/x-www-form-urlencoded"},url:P,method:"POST",auth:{username:"web_app",password:"changeit"},data:"grant_type=refresh_token&refresh_token=".concat(t,"&scope=openid")};e.callAPI(o,n,r,!0)}))}}]),e}();B.callAPI=function(e,t,n,r){(r?K:$)(e).then((function(e){N("GET ::::::: response",e),t(e.data)})).catch((function(e){N("GET ::::::: err",e),n(e.data)}))};var V=n(43),Y=n.n(V),Q=function(e,t,n){return function(){var r=Object(X.a)(M.a.mark((function r(o){var a;return M.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,B.post(S,{email:e,password:t,device:{}});case 3:N(a=r.sent,"---login response----"),0===a.code?(N("success","---login response----"),o({type:d,payload:a.data}),x.a.set("userSession",a),x.a.set("sessionTill",Y()().add(20,"m").toDate()),n(!0)):n(!1),r.next=12;break;case 8:r.prev=8,r.t0=r.catch(0),N(r.t0,"--Login error--"),n(!1);case 12:case"end":return r.stop()}}),r,null,[[0,8]])})));return function(e){return r.apply(this,arguments)}}()},Z=(n(32),n(1)),ee="297983414833872",te="v10.0",ne="pages_show_list,pages_read_engagement,instagram_basic,instagram_manage_insights",re=encodeURIComponent("https://web.embassysocial.io/redirect"),oe="fbloged=1",ae=function(e){Object(j.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(f.a)(this,n);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))).buildUrlFb=function(){return"https://www.facebook.com/".concat(te,"/dialog/oauth?client_id=").concat(ee,"&redirect_uri=").concat(re,"&scope=").concat(ne,"&state=").concat(oe,"&response_type=code")},e.popupWindow=function(e,t,n,r,o){var a=n.top.outerHeight/2+n.top.screenY-o/2,s=n.top.outerWidth/2+n.top.screenX-r/2;return n.open(e,t,"toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=no,resizable=no,copyhistory=no,width=".concat(r,",height=").concat(o,",top=").concat(a,",left=").concat(s))},e.openFbDialog=Object(X.a)(M.a.mark((function t(){var n,r,o;return M.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.buildUrlFb(),t.next=3,e.popupWindow(n,"",window,1e3,600);case 3:r=t.sent,console.log(r,"fbWindow"),o=setInterval(Object(X.a)(M.a.mark((function e(){return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r.closed&&(clearInterval(o),console.log(r.document,"fbWindow.document"),console.log(r.document.URL,"fbWindow.document.URL"),console.log(r.document.documentURI,"fbWindow.document.documentURI"));case 1:case"end":return e.stop()}}),e)}))),1e3);case 6:case"end":return t.stop()}}),t)}))),e.myFbLogin=Object(X.a)(M.a.mark((function t(){var n;return M.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.openFbDialog();case 3:n=t.sent,console.log(n),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),console.log("there was an error");case 10:case"end":return t.stop()}}),t,null,[[0,7]])}))),e}return Object(b.a)(n,[{key:"render",value:function(){var e=this;return Object(Z.jsx)("div",{children:Object(Z.jsx)("button",{onClick:function(){e.myFbLogin()},children:"Login with Fb manually"})})}}]),n}(r.Component),se=/^\S*$/,ce=function(e){Object(j.a)(n,e);var t=Object(m.a)(n);function n(e){var r;return Object(f.a)(this,n),(r=t.call(this,e)).componentDidMount=function(){A()&&r.props.history.push(W)},r.handleChange=function(e){r.setState(Object(H.a)({},e.target.name,e.target.value.trim("")))},r.onClickLogin=function(){var e=r.state,t=e.email,n=e.password;r.setState({showLoginError:!1}),z(t)||z(n)||!se.test(t)||!se.test(n)?r.setState({hasError:!0}):(r.setState({showLoading:!0}),r.props.authenticate(r.state.email.trim(),r.state.password.trim(),(function(e){console.log(e,"resultresultresultresult"),r.setState({showLoading:!1}),e?r.props.history.push(W):r.setState({showLoginError:!0})})))},r.state={email:"",password:"",showLoading:!1,hasError:!1,showLoginError:!1,showPassword:!1},r}return Object(b.a)(n,[{key:"render",value:function(){var e=this,t=this.state,n=t.email,r=t.password,o=t.hasError,a=t.showLoginError,s=t.showPassword;return Object(Z.jsxs)(Z.Fragment,{children:[Object(Z.jsx)("h3",{children:"Login"}),Object(Z.jsx)("p",{className:"text-muted",children:"Login to your account using your credentials"}),Object(Z.jsxs)("div",{className:"form-group",children:[Object(Z.jsx)("label",{children:"Email"}),Object(Z.jsx)("div",{className:"input-group mb-3",children:Object(Z.jsx)("input",{type:"text",className:"form-control",placeholder:"Enter email",name:"email",onChange:function(t){return e.handleChange(t)},value:n})}),o&&(z(n)||!se.test(n))&&Object(Z.jsx)("div",{children:Object(Z.jsx)("small",{className:"text-danger",children:"Enter valid email."})})]}),Object(Z.jsxs)("div",{className:"form-group",children:[Object(Z.jsx)("label",{children:"Password"}),Object(Z.jsxs)("div",{className:"input-group mb-3",children:[Object(Z.jsx)("input",{type:s?"text":"password",className:"form-control",placeholder:"Enter password",name:"password",onChange:function(t){return e.handleChange(t)},value:r,onKeyPress:function(t){"Enter"===t.key&&e.onClickLogin()}}),Object(Z.jsx)("div",{className:"input-group-append",onClick:function(){return e.setState({showPassword:!e.state.showPassword})},children:Object(Z.jsx)("span",{className:"input-group-text bg-transparent",children:Object(Z.jsx)("i",{className:"fa ".concat(s?"fa-eye-slash":"fa-eye")})})})]}),o&&(z(r)||!se.test(r))&&Object(Z.jsx)("div",{children:Object(Z.jsx)("small",{className:"text-danger",children:"Enter valid password."})})]}),a&&Object(Z.jsx)("div",{children:Object(Z.jsx)("small",{className:"text-danger",children:"Invalid email or password."})}),Object(Z.jsxs)("div",{className:"d-flex justify-content-between mt-4",children:[Object(Z.jsx)("button",{className:"btn btn-dark px-4",onClick:function(){return e.onClickLogin()},disabled:this.state.showLoading,children:"Login"}),Object(Z.jsx)(ae,{})]})]})}}]),n}(r.Component),ie=Object(c.b)(null,{authenticate:Q})(ce),ue=function(e){Object(j.a)(n,e);var t=Object(m.a)(n);function n(e){var r;return Object(f.a)(this,n),(r=t.call(this,e)).state={showLoading:!1},r}return Object(b.a)(n,[{key:"componentDidMount",value:function(){window.addEventListener("load",(function(e){window.close()}))}},{key:"render",value:function(){return Object(Z.jsx)(Z.Fragment,{children:Object(Z.jsx)("h3",{children:"Redirect"})})}}]),n}(r.Component),le=Object(c.b)(null,{})(ue),de=function(e){var t=e.children;return Object(Z.jsx)("div",{children:t})},pe=function(e){Object(j.a)(n,e);var t=Object(m.a)(n);function n(e){var r;return Object(f.a)(this,n),(r=t.call(this,e)).handleChange=function(e){r.setState(Object(H.a)({},e.target.name,e.target.value))},r.onClickLogout=function(){I(),r.props.history.push(F)},r.state={username:"",password:"",showLoading:!1,hasError:!1,showLoginError:!1},r}return Object(b.a)(n,[{key:"render",value:function(){var e=this;return Object(Z.jsx)(de,{children:Object(Z.jsxs)(Z.Fragment,{children:[Object(Z.jsx)("h3",{children:"Dashboard"}),Object(Z.jsx)("button",{onClick:function(){return e.onClickLogout()},children:"logout"})]})})}}]),n}(r.Component),he=Object(c.b)(null,{authenticate:Q})(pe),fe=(n(86),function(e){var t=e.component,n=Object(w.a)(e,["component"]);return Object(Z.jsx)(v.b,Object(l.a)(Object(l.a)({},n),{},{render:function(e){return A()?Object(Z.jsx)(t,Object(l.a)({},e)):Object(Z.jsx)(v.a,{to:F})}}))}),be=function(e){Object(j.a)(n,e);var t=Object(m.a)(n);function n(){return Object(f.a)(this,n),t.apply(this,arguments)}return Object(b.a)(n,[{key:"render",value:function(){return Object(Z.jsx)(o.a.Fragment,{children:Object(Z.jsx)(o.a.StrictMode,{children:Object(Z.jsx)(O.a,{children:Object(Z.jsx)(o.a.Fragment,{children:Object(Z.jsxs)(v.d,{children:[Object(Z.jsx)(v.b,{path:F,exact:!0,component:ie}),Object(Z.jsx)(v.b,{path:R,exact:!0,component:le}),Object(Z.jsx)(fe,{path:W,exact:!0,component:he})]})})})})})}}]),n}(r.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var je=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||i.d,me=Object(i.e)(h,T?je(Object(i.a)(u.a)):Object(i.a)(u.a));s.a.render(Object(Z.jsx)(c.a,{store:me,children:Object(Z.jsx)(be,{})}),document.querySelector("#root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[90,1,2]]]);
//# sourceMappingURL=main.cf608411.chunk.js.map